

<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Pro Live Player</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/artplayer/dist/artplayer.js"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #000; overflow: hidden; }
        .artplayer-app { width: 100%; height: 100%; }
    </style>
</head>
<body>

    <div class="artplayer-app"></div>

    <script>
		var params={};
		window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(str,key,value){params[key]=value;});
        var streamUrl = params["ch"];
        var logoUrl = "";

        var art = new Artplayer({
            container: '.artplayer-app',
            url: streamUrl,
			attributes: {
				playsinline: 'playsinline',
				'webkit-playsinline': 'webkit-playsinline',
				'x-webkit-airplay': 'allow',
			},
            type: 'm3u8',
            isLive: true,
            volume: 1.0,
            autoplay: true,
            pip: true,
            autoSize: true,
            autoMini: true,
            setting: true,
            loop: true,
            flip: true,
            playbackRate: true,
            aspectRatio: true,
            fullscreen: true,
            fullscreenWeb: true,
            miniProgressBar: true,
            lock: true,
            fastForward: true,
            autoOrientation: true,
			playsInline: true,
			autoPlayback: true,
			airPlay: true,
            
            // تفعيل إعدادات الجودة
            quality: [], 

            customType: {
                m3u8: function (video, url, art) {
                    if (Hls.isSupported()) {
                        const hls = new Hls();
                        hls.loadSource(url);
                        hls.attachMedia(video);

                        // === كود اكتشاف الجودات ===
                        hls.on(Hls.Events.MANIFEST_PARSED, function (event, data) {
                            
                            // إذا وجدنا أكثر من مستوى للجودة
                            if (data.levels.length > 1) {
                                var levelList = [];
                                
                                // إضافة خيار "تلقائي" (Auto)
                                levelList.push({
                                    default: true,
                                    html: 'Auto',
                                    level: -1 // -1 يعني تلقائي في HLS.js
                                });

                                // جلب باقي الجودات من الملف
                                data.levels.forEach(function (level, index) {
                                    levelList.push({
                                        html: level.height + 'p', // يكتب مثلاً 720p
                                        level: index // رقم المستوى
                                    });
                                });

                                // تحديث قائمة الجودة في المشغل
                                art.quality = levelList;
                            }
                        });

                        // === عند قيام المستخدم بتغيير الجودة ===
                        art.on('video:quality', function (item) {
                            hls.currentLevel = item.level; // أمر HLS بتغيير الجودة
                        });

                    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                        video.src = url;
                    }
                },
            },

            layers: [
                {
                    html: ``,
                    style: {
                        position: 'absolute',
                        bottom: '50px',
                        left: '20px',
                        zIndex: 10,
                        pointerEvents: 'none',
                    },
                },
            ],
            
            lang: 'ar',
        });

        art.on('ready', () => { art.play(); });
    </script>
</body>
</html>