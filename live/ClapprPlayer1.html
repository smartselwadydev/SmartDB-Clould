

<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>WEGOAL Player</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/artplayer/dist/artplayer.js"></script>

    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #000; overflow: hidden; }
        .artplayer-app { width: 100%; height: 100%; }
    </style>
</head>
<body>

    <div class="artplayer-app"></div>

    <script>
		var params={};
		window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(str,key,value){params[key]=value;});
        var streamUrl = params["ch"];
        var logoUrl = "";

        var art = new Artplayer({
            container: '.artplayer-app',
            url: streamUrl,
			attributes: {
				'controls': 'controls',
				'playsinline': 'playsinline',
				'webkit-playsinline': 'webkit-playsinline',
				'x-webkit-airplay': 'allow',
			},
            type: 'm3u8',
            isLive: true,
            volume: 1.0,
            autoplay: true,
            pip: true,
            autoSize: true,
            autoMini: true,
            setting: true,
            loop: true,
            flip: true,
            playbackRate: true,
            aspectRatio: true,
            fullscreen: true,
            fullscreenWeb: true,
            miniProgressBar: true,
            lock: true,
            fastForward: true,
            autoOrientation: true,
			screenshot: true,
			subtitleOffset: true,
			mutex: true,
			backdrop: true,
			playsInline: true,
			autoPlayback: true,
			airPlay: true,
            
            // تفعيل إعدادات الجودة
            quality: [], 

            customType: {
                m3u8: function (video, url, art) {
                    if (Hls.isSupported()) {
                        const hls = new Hls();
                        hls.loadSource(url);
                        hls.attachMedia(video);

                        // === كود اكتشاف الجودات ===
                        hls.on(Hls.Events.MANIFEST_PARSED, function (event, data) {
                            
                            // إذا وجدنا أكثر من مستوى للجودة
                            if (data.levels.length > 1) {
                                var levelList = [];
                                
                                // إضافة خيار "تلقائي" (Auto)
                                levelList.push({
                                    default: true,
                                    html: 'Auto',
                                    level: -1 // -1 يعني تلقائي في HLS.js
                                });

                                // جلب باقي الجودات من الملف
                                data.levels.forEach(function (level, index) {
                                    levelList.push({
                                        html: level.height + 'p', // يكتب مثلاً 720p
                                        level: index // رقم المستوى
                                    });
                                });

                                // تحديث قائمة الجودة في المشغل
                                art.quality = levelList;
                            }
                        });

                        // === عند قيام المستخدم بتغيير الجودة ===
                        art.on('video:quality', function (item) {
                            hls.currentLevel = item.level; // أمر HLS بتغيير الجودة
                        });

                    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                        video.src = url;
                    }
                },
            },

            layers: [
                {
                    html: ``,
                    style: {
                        position: 'absolute',
                        bottom: '50px',
                        left: '20px',
                        zIndex: 10,
                        pointerEvents: 'none',
                    },
                },
            ],
            
            lang: 'ar',
        });
        art.on('ready', () => { 
			art.play(); 
		});
		
document.addEventListener('DOMContentLoaded', function() {
  const video = document.createElement('video');
  video.setAttribute('playsinline', '');
  video.setAttribute('webkit-playsinline', '');
  video.controls = true;
  document.body.appendChild(video);

  // Screen Wake Lock variables
  let wakeLock = null;

  // Function to request screen wake lock
  async function requestWakeLock() {
    try {
      if ('wakeLock' in navigator) {
        wakeLock = await navigator.wakeLock.request('screen');
        console.log('Screen Wake Lock is active');
        
        // Listen for release
        wakeLock.addEventListener('release', () => {
          console.log('Screen Wake Lock was released');
        });
      } else {
        console.warn('Screen Wake Lock API not supported');
      }
    } catch (err) {
      console.error(`Failed to request wake lock: ${err.message}`);
    }
  }

  // Function to release screen wake lock
  function releaseWakeLock() {
    if (wakeLock !== null) {
      wakeLock.release();
      wakeLock = null;
      console.log('Screen Wake Lock released');
    }
  }

  // Request wake lock when video starts playing
  video.addEventListener('play', async () => {
    await requestWakeLock();
  });

  // Release wake lock when video pauses
  video.addEventListener('pause', () => {
    releaseWakeLock();
  });

  // Release wake lock when video ends
  video.addEventListener('ended', () => {
    releaseWakeLock();
  });

  // Handle visibility change (when user switches tabs)
  document.addEventListener('visibilitychange', async () => {
    if (document.visibilityState === 'visible' && !video.paused) {
      // Re-request wake lock when user comes back to tab
      await requestWakeLock();
    }
  });
});
    </script>
</body>
</html>