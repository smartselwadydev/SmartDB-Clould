<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>WEGOAL Player</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/artplayer/dist/artplayer.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #000; overflow: hidden; }
        .artplayer-app { width: 100%; height: 100%; }
    </style>
</head>
<body>

    <div class="artplayer-app"></div>

    <script>
        var params = {};
        window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (str, key, value) { params[key] = value; });
        var streamUrl = params["ch"];

        // === WAKE LOCK FUNCTIONALITY ===
        let wakeLock = null;

        async function requestWakeLock() {
            if ('wakeLock' in navigator) {
                try {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('Wake Lock active');
                } catch (err) {
                    console.error(`${err.name}, ${err.message}`);
                }
            }
        }

        function releaseWakeLock() {
            if (wakeLock !== null) {
                wakeLock.release();
                wakeLock = null;
                console.log('Wake Lock released');
            }
        }
        // ==============================

        var art = new Artplayer({
            container: '.artplayer-app',
            url: streamUrl,
            attributes: {
                'controls': 'controls',
                'playsinline': 'playsinline',
                'webkit-playsinline': 'webkit-playsinline',
                'x-webkit-airplay': 'allow',
            },
            type: 'm3u8',
            isLive: true,
            volume: 1.0,
            autoplay: false,
            pip: true,
            autoSize: true,
            autoMini: true,
            setting: true,
            loop: true,
            flip: true,
            playbackRate: true,
            aspectRatio: true,
            fullscreen: true,
            fullscreenWeb: true,
            miniProgressBar: true,
            lock: true,
            fastForward: true,
            autoOrientation: true,
            screenshot: true,
            subtitleOffset: true,
            mutex: true,
            backdrop: true,
            playsInline: true,
            autoPlayback: true,
            airPlay: true,

            quality: [],

            customType: {
                m3u8: function (video, url, art) {
                    if (Hls.isSupported()) {
                        const hls = new Hls();
                        hls.loadSource(url);
                        hls.attachMedia(video);

                        hls.on(Hls.Events.MANIFEST_PARSED, function (event, data) {
                            if (data.levels.length > 1) {
                                var levelList = [];

                                levelList.push({
                                    default: true,
                                    html: 'Auto',
                                    level: -1
                                });

                                data.levels.forEach(function (level, index) {
                                    levelList.push({
                                        html: level.height + 'p',
                                        level: index
                                    });
                                });

                                art.quality = levelList;
                            }
                        });

                        art.on('video:quality', function (item) {
                            hls.currentLevel = item.level;
                        });

                    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                        video.src = url;
                    }
                },
            },
            lang: 'ar',
        });

        // === Event Listeners for Wake Lock ===
        art.on('play', () => {
            requestWakeLock();
        });

        art.on('pause', () => {
            releaseWakeLock();
        });

        art.on('video:ended', () => {
            releaseWakeLock();
        });
        // =====================================

        art.on('ready', () => {
            art.play();
        });
    </script>
</body>
</html>